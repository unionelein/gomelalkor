{% import _self as pageMacros %}

{% macro page(page, value, currentPage) %}
    <li class="{% if value == currentPage %}active{% endif %}">
        {% set params = (app.request.attributes.get('_route_params') | merge({'page': page})) %}
        <a class="js-page"
           href="{{ path(app.request.attributes.get('_route'), params) }}"
           data-url="{{ path(app.request.attributes.get('_route'), params) }}"
        >
            {{ value|raw }}
        </a>
    </li>
{% endmacro %}

{% if currentCategory is defined %}
    <h1>{{ type == prokat ? 'Прокат' : 'Купить' }} {{ currentCategory.name }}</h1>
{% endif %}

{% for product in products %}
    <div class="product-wrapper js-product">
        <span class="type {{ product.type ? "green" : "red" }}">{{ product.type ? "Покупка" : "Прокат" }}</span>
        <p class="name" style="margin-top: 20px;">
            <a href="{{ path('product', { categorySlug: product.category.slug, productSlug: product.slug }) }}"
               title="{{ product.type ? "Купить" : "Прокат" }} {{ product.name }} в Гомеле"
               class="js-product-link"
            >{{ product.name }}</a>
        </p>
        <div class="product-img">
            <img src="{{ asset('images/' ~ product.imgMin) }}" alt="{{ product.name }}">
        </div>
        <p class="short-description">{{ product.shortDescription }}</p>
        <span class="price"><span class="number">{{ product.price }}</span> руб{% if product.type == prokat %}/сутки{% endif %}</span>
    </div>
{% else %}
    <p class="text-info" style="margin: 40px 0 0 30%;">Похоже, что здесь ничего нет :(</p>
{% endfor %}

{% if countOfPages > 1  and currentPage <= countOfPages %}
    <div class="clear"></div>
    <div class="pag">
        <ul class="pagination">
            {% set offset = 2 %}

            {% if currentPage > (offset + 1) %}
                {{ pageMacros.page(currentPage - 1, '<i class="fa fa-angle-left"></i>', currentPage) }}
            {% endif %}

            {% for i in 1..countOfPages %}
                {% if i >= (currentPage - offset) and i <= (currentPage + offset)  %}
                    {{ pageMacros.page(i, i, currentPage) }}
                {% endif %}
            {% endfor %}

            {% if currentPage < (countOfPages - offset - 1) %}
                {{ pageMacros.page(currentPage + 1, '<i class="fa fa-angle-right"></i>', currentPage) }}
            {% endif %}
        </ul>
    </div>
{% endif %}
